{% extends 'admin/theme/base.html.twig' %}

{% block title %}Nouveau th√®me ‚Äî NEXA{% endblock %}

{% block body %}

<!-- ================= HEADER ================= -->
<div class="page-header">
    <div>
        <h1>Cr√©er un nouveau th√®me</h1>
        <p>D√©finissez les informations principales du th√®me</p>
    </div>
    
    <a href="{{ path('app_theme_index') }}" class="btn">
        ‚Üê Retour √† la liste
    </a>
</div>

<div class="form-shell">
    <div class="form-card">
        
        {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
        
        {% if form.vars.submitted and not form.vars.valid %}
            <div class="form-errors-box">
                <strong>‚ö†Ô∏è Veuillez corriger les erreurs suivantes :</strong>
                <ul>
                    {% for field in form %}
                        {% for error in field.vars.errors %}
                            <li>{{ error.message }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        <!-- LAYOUT 2 COLONNES -->
        <div class="form-two-columns">
            
            <!-- COLONNE GAUCHE -->
            <div class="form-column-left">
                
                <!-- Informations g√©n√©rales -->
                <div class="form-section">
                    <h3>üìå Informations g√©n√©rales</h3>
                    
                    <div>
                        <label class="field-label">Nom du th√®me</label>
                        {{ form_widget(form.nom, { attr: { class: 'field', placeholder: 'Choisir un domaine' } }) }}
                    </div>
                    
                    <div style="margin-top: 1.25rem;">
                        <label class="field-label">Priorit√©</label>
                        <div class="priority-control">
                            {{ form_widget(form.priorite, { attr: { class: 'field priority-select js-priority-select' } }) }}
                            <div class="priority-preview js-priority-preview" aria-hidden="true">
                                <span class="priority-preview-title">Niveau visuel</span>
                                <div class="priority-preview-stars">
                                    <i class="fa-regular fa-star" data-level="1"></i>
                                    <i class="fa-regular fa-star" data-level="2"></i>
                                    <i class="fa-regular fa-star" data-level="3"></i>
                                </div>
                                <small class="priority-preview-text js-priority-text">Moyenne</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.25rem;">
                        <label class="field-label">Description</label>
                        {{ form_widget(form.description_q, {
                            attr: { class: 'field', rows: 5, placeholder: 'D√©crivez bri√®vement ce th√®me...' }
                        }) }}
                    </div>
                </div>
                
                <!-- Intention -->
                <div class="form-section">
                    <h3>üéØ Intention</h3>
                    {{ form_widget(form.intention, {
                        attr: { class: 'field', placeholder: 'Ex: Am√©liorer le bien-√™tre quotidien' }
                    }) }}
                </div>
                
            </div>
            
            <!-- COLONNE DROITE -->
            <div class="form-column-right">
                
                <!-- Apparence -->
                <div class="form-section">
                    <h3>üé® Apparence</h3>
                    
                    <div>
                        <label class="field-label">Ic√¥ne</label>
                        <div class="icon-grid">
                            {% for choice in form.icone %}
                                <label class="icon-option">
                                    {{ form_widget(choice) }}
                                    <div class="icon-box">
                                        <i class="{{ choice.vars.value }}"></i>
                                    </div>
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <label class="field-label">Couleur</label>
                        <div class="color-picker-wrapper">
                            {{ form_widget(form.couleur, { attr: { class: 'color-input' } }) }}
                        </div>
                    </div>
                </div>
                
                <!-- Statut -->
                <div class="form-section">
                    <h3>‚öôÔ∏è Statut</h3>
                    <label class="switch-label">
                        {{ form_widget(form.actif) }}
                        Activer ce th√®me
                    </label>
                </div>
                
            </div>
            
        </div>
        
        <!-- Actions (pleine largeur en bas) -->
        <div class="form-actions">
            <button type="submit" class="btn primary">
                <i class="fa-solid fa-check"></i>
                Cr√©er le th√®me
            </button>
            
            <a href="{{ path('app_theme_index') }}" class="btn">
                Annuler
            </a>
        </div>
        
        {{ form_end(form) }}
        
    </div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const select = document.querySelector('.js-priority-select');
        const preview = document.querySelector('.js-priority-preview');
        if (!select || !preview) return;

        const stars = preview.querySelectorAll('[data-level]');
        const text = preview.querySelector('.js-priority-text');
        const labels = { 1: 'Basse', 2: 'Moyenne', 3: 'Haute' };

        function refresh() {
          const level = parseInt(select.value || '2', 10);
          stars.forEach((star) => {
            const starLevel = parseInt(star.getAttribute('data-level'), 10);
            star.classList.toggle('fa-solid', starLevel <= level);
            star.classList.toggle('fa-regular', starLevel > level);
          });
          if (text) text.textContent = labels[level] || 'Moyenne';
        }

        select.addEventListener('change', refresh);
        refresh();
      });
    </script>
{% endblock %}
